const DeedCard = require('../../deedcard.js');
/** @typedef {import('../../AbilityDsl')} AbilityDsl */

class LulasExploit extends DeedCard {
    /** @param {AbilityDsl} ability */
    setupCardAbilities(ability) {
        this.persistentEffect({
            match: this,
            effect: ability.effects.canSpendGhostRock(spendParams =>
                spendParams.activePlayer === this.controller && 
                spendParams.context && spendParams.context.source &&
                spendParams.context.source.hasKeyword('gadget') && 
                this.isCardAbility(spendParams)
            )
        });

        this.traitReaction({
            when: {
                onProductionReceived: () => true
            },
            handler: () => {
                const grChange = 2 - this.ghostrock;
                if(grChange) {
                    this.modifyGhostRock(grChange);
                }
            }
        });
    }
    
    isCardAbility(spendParams) {
        if(!spendParams.context || !spendParams.context.ability) {
            return false;
        }
        return spendParams.context.ability.isCardAbility();
    }
}

LulasExploit.code = '08011';

module.exports = LulasExploit;
